/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */
plugins {
    id "java-library"
    id "maven-publish"
    id "signing"
    id "jacoco"
    id 'org.sonarqube' version '3.1.1'
    id "dev.clojurephant.clojure" version "0.6.0" apply false
    id 'com.google.cloud.tools.jib' version '2.7.1' apply false
    id "io.spring.dependency-management" version "1.0.11.RELEASE" apply false
    id "net.researchgate.release" version "2.8.1"
}

ext {
    h2Version = "1.4.200"
    owlVersion = "5.1.14"
    junitJupiterVersion = "5.6.2"
    jenaVersion = "3.14.0"
    slf4jVersion = "1.7.30"
    caffeineVersion = "2.8.5"
    checkerVersion = "3.3.0"
    commonsLangVersion = "3.10"
    esriVersion = '2.2.3'
    geotoolsVersion = "24.1"
    metricsVersion = "4.1.5"
    postgresVersion = '42.2.14'
    guiceVersion = "4.2.3"
    mockitoVersion = '3.3.3'
}

allprojects {
    repositories {
        // This needs to go first, in order to get the jai core jars, which jcenter doesn't have.
        maven { url "https://repo.osgeo.org/repository/release/" }
        jcenter()
        mavenCentral()
        maven { url "https://clojars.org/repo" }
        maven { url "https://jitpack.io" }
    }
}

subprojects {
    apply plugin: 'java-library'
    apply plugin: 'jacoco'
    apply plugin: "io.spring.dependency-management"

    dependencyManagement {
        imports {
            mavenBom "com.fasterxml.jackson:jackson-bom:2.12.1"
            mavenBom "org.eclipse.rdf4j:rdf4j-bom:3.5.1"
        }
        dependencies {
            dependency group: 'commons-io', name: 'commons-io', version: '2.8.0'
            dependency group: 'me.tongfei', name: 'progressbar', version: '0.9.0'
            dependency group: 'org.locationtech.jts', name: 'jts-core', version: "1.18.0"
            dependency group: 'com.esri.geometry', name: 'esri-geometry-api', version: '2.2.4'
            dependency group: 'com.google.guava', name: 'guava', version: "30.1-jre"
            dependency group: 'com.google.inject', name: 'guice', version: guiceVersion
        }
    }

    jacocoTestReport {
        reports {
            xml.enabled = true
        }
    }

    dependencies {
        // Dependencies
        compileOnly group: 'org.checkerframework', name: 'checker', version: checkerVersion
        implementation group: 'net.sourceforge.owlapi', name: 'owlapi-api', version: owlVersion
        implementation group: 'org.slf4j', name: 'slf4j-api', version: slf4jVersion
        implementation group: "com.typesafe", name: "config", version: "1.4.1"
        testImplementation group: 'org.junit.jupiter', name: 'junit-jupiter-api', version: junitJupiterVersion
        testImplementation group: 'org.junit.jupiter', name: 'junit-jupiter-params', version: junitJupiterVersion
        testRuntimeOnly group: 'org.junit.jupiter', name: 'junit-jupiter-engine', version: junitJupiterVersion
    }
    java {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
        withJavadocJar()
        withSourcesJar()
    }

    tasks.withType(JavaCompile) {
        options.compilerArgs << '-parameters'
    }

    test {
        useJUnitPlatform()
    }

    release {
        git {
            signTag = true
        }
    }
}

publishing {
    publications {
        mavenJava(MavenPublication) {

        }
    }
    repositories {
        maven {
            def stagingUrl = "https://oss.sonatype.org/service/local/staging/deploy/maven2"
            def snapshotUrl = "https://oss.sonatype.org/content/repositories/snapshots"
            url version.endsWith("SNAPSHOT") ? snapshotUrl : stagingUrl
            credentials {
                username project.hasProperty("sonatypeUsername") ? project.property("sonatypeUsername") : System.getenv("SONATYPE_USERNAME")
                password project.hasProperty("sonatypePassword") ? project.property("sonatypePassword") : System.getenv("SONATYPE_PASSWORD")
            }
            name "oss-sonatype"
        }
    }
}
